{"version":3,"file":"store.js","sourceRoot":"","sources":["../src/store.ts"],"names":[],"mappings":"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","sourcesContent":["import {content, token, debug} from './output.js'\nimport constants from './constants.js'\nimport {Abort} from './error.js'\nimport Conf, {Schema} from 'conf'\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\n\nconst migrations = {}\n\nexport interface CachedAppInfo {\n  directory: string\n  appId: string\n  title?: string\n  orgId?: string\n  storeFqdn?: string\n}\n\ninterface ConfSchema {\n  appInfo: CachedAppInfo[]\n  themeStore: string\n  session: string\n}\n\nconst schema = {\n  appInfo: {\n    type: 'array',\n    items: {\n      type: 'object',\n      properties: {\n        appId: {\n          type: 'string',\n        },\n        orgId: {\n          type: 'string',\n        },\n        storeFqdn: {\n          type: 'string',\n        },\n      },\n    },\n  },\n} as unknown as Schema<ConfSchema>\n\nlet _instance: CLIKitStore | undefined\n\nexport function cliKitStore() {\n  if (!_instance) {\n    throw new Abort(\"The CLIKitStore instance hasn't been initialized\")\n  }\n  return _instance\n}\n\nexport async function initializeCliKitStore() {\n  if (!_instance) {\n    // eslint-disable-next-line require-atomic-updates\n    _instance = new CLIKitStore({\n      schema,\n      migrations,\n      projectName: 'shopify-cli-kit',\n      projectVersion: await constants.versions.cliKit(),\n    })\n  }\n}\n\nexport class CLIKitStore extends Conf<ConfSchema> {\n  getAppInfo(directory: string): CachedAppInfo | undefined {\n    debug(content`Reading cached app information for directory ${token.path(directory)}...`)\n    const apps = this.get('appInfo') ?? []\n    return apps.find((app: CachedAppInfo) => app.directory === directory)\n  }\n\n  setAppInfo(options: {directory: string; appId: string; title?: string; storeFqdn?: string; orgId?: string}): void {\n    debug(content`Storing app information for directory ${token.path(options.directory)}:\n${token.json(options)}\n`)\n    const apps = this.get('appInfo') ?? []\n    const index = apps.findIndex((saved: CachedAppInfo) => saved.directory === options.directory)\n    if (index === -1) {\n      apps.push(options)\n    } else {\n      const app: CachedAppInfo = apps[index]\n      apps[index] = {\n        appId: options.appId,\n        directory: options.directory,\n        title: options.title ?? app.title,\n        storeFqdn: options.storeFqdn ?? app.storeFqdn,\n        orgId: options.orgId ?? app.orgId,\n      }\n    }\n    this.set('appInfo', apps)\n  }\n\n  clearAppInfo(directory: string): void {\n    debug(content`Clearning app information for directory ${token.path(directory)}...`)\n    const apps = this.get('appInfo') ?? []\n    const index = apps.findIndex((saved: CachedAppInfo) => saved.directory === directory)\n    if (index !== -1) {\n      apps.splice(index, 1)\n    }\n    this.set('appInfo', apps)\n  }\n\n  getTheme(): string | undefined {\n    debug(content`Getting theme store...`)\n    return this.get('themeStore')\n  }\n\n  setTheme(store: string): void {\n    debug(content`Setting theme store...`)\n    this.set('themeStore', store)\n  }\n\n  getSession(): string | undefined {\n    debug(content`Getting session store...`)\n    return this.get('sessionStore')\n  }\n\n  setSession(store: string): void {\n    debug(content`Setting session store...`)\n    this.set('sessionStore', store)\n  }\n\n  removeSession(): void {\n    debug(content`Removing session store...`)\n    this.set('sessionStore', '')\n  }\n}\n"]}