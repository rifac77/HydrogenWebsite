{"version":3,"file":"dependency.js","sourceRoot":"","sources":["../src/dependency.ts"],"names":[],"mappings":"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","sourcesContent":["import {exec} from './system.js'\nimport {exists as fileExists, read as readFile} from './file.js'\nimport {glob, dirname, join as pathJoin, findUp} from './path.js'\nimport {Abort, Bug} from './error.js'\nimport {latestNpmPackageVersion} from './version.js'\nimport {Version} from './semver.js'\nimport {content, token, debug} from './output.js'\nimport {AbortController, AbortSignal} from 'abort-controller'\nimport type {Writable} from 'node:stream'\nimport type {ExecOptions} from './system.js'\n\nexport const genericConfigurationFileNames = {\n  yarn: {\n    lockfile: 'yarn.lock',\n  },\n  pnpm: {\n    lockfile: 'pnpm-lock.yaml',\n  },\n} as const\n\nexport const dependencyManager = ['yarn', 'npm', 'pnpm'] as const\nexport type DependencyManager = typeof dependencyManager[number]\n\nexport const PackageJsonNotFoundError = (directory: string) => {\n  return new Abort(`The directory ${directory} doesn't have a package.json.`)\n}\n\nexport const FindUpAndReadPackageJsonNotFoundError = (directory: string) => {\n  return new Bug(content`Couldn't find a a package.json traversing directories from ${token.path(directory)}`)\n}\n\n/**\n * Returns the dependency manager used to run the create workflow.\n * @param env {Object} The environment variables of the process in which the CLI runs.\n * @returns The dependency manager\n */\nexport function dependencyManagerUsedForCreating(env = process.env): DependencyManager {\n  if (env.npm_config_user_agent?.includes('yarn')) {\n    return 'yarn'\n  } else if (env.npm_config_user_agent?.includes('pnpm')) {\n    return 'pnpm'\n  } else {\n    return 'npm'\n  }\n}\n\n/**\n * Returns the dependency manager used by an existing project.\n * @param directory {string} The root directory of the project.\n * @returns The dependency manager\n */\nexport async function getDependencyManager(directory: string): Promise<DependencyManager> {\n  debug(content`Obtaining the dependency manager in directory ${token.path(directory)}...`)\n  const yarnLockPath = pathJoin(directory, genericConfigurationFileNames.yarn.lockfile)\n  const pnpmLockPath = pathJoin(directory, genericConfigurationFileNames.pnpm.lockfile)\n  if (await fileExists(yarnLockPath)) {\n    return 'yarn'\n  } else if (await fileExists(pnpmLockPath)) {\n    return 'pnpm'\n  } else {\n    return 'npm'\n  }\n}\n\ninterface InstallNPMDependenciesRecursivelyOptions {\n  /**\n   * The dependency manager to use to install the dependencies.\n   */\n  dependencyManager: DependencyManager\n  /**\n   * The directory from where we'll find package.json's recursively\n   */\n  directory: string\n\n  /**\n   * Specifies the maximum depth of the glob search.\n   */\n  deep?: number\n}\n\n/**\n * This function traverses down a directory tree to find directories containing a package.json\n * and installs the dependencies if needed. To know if it's needed, it uses the \"check\" command\n * provided by dependency managers.\n * @param options {InstallNPMDependenciesRecursivelyOptions} Options to install dependencies recursively.\n */\nexport async function installNPMDependenciesRecursively(options: InstallNPMDependenciesRecursivelyOptions) {\n  const packageJsons = await glob(pathJoin(options.directory, '**/package.json'), {\n    ignore: [pathJoin(options.directory, 'node_modules/**/package.json')],\n    cwd: options.directory,\n    onlyFiles: true,\n    deep: options.deep,\n  })\n  const abortController = new AbortController()\n  try {\n    await Promise.all(\n      packageJsons.map(async (packageJsonPath) => {\n        const directory = dirname(packageJsonPath)\n        await install(directory, options.dependencyManager, undefined, undefined, abortController.signal)\n      }),\n    )\n  } catch (error) {\n    abortController.abort()\n    throw error\n  }\n}\n\n/**\n * Installs the dependencies in the given directory.\n * @param directory {string} The directory that contains the package.json\n * @param dependencyManager {DependencyManager} The dependency manager to use to install the dependencies.\n * @param stdout {Writable} Standard output stream.\n * @param stderr {Writable} Standard error stream.\n * @param signal {AbortSignal} Abort signal.\n * @returns stderr {Writable} Standard error stream.\n */\nexport async function install(\n  directory: string,\n  dependencyManager: DependencyManager,\n  stdout?: Writable,\n  stderr?: Writable,\n  signal?: AbortSignal,\n) {\n  const options: ExecOptions = {cwd: directory, stdin: undefined, stdout, stderr, signal}\n  await exec(dependencyManager, ['install'], options)\n}\n\n/**\n * Returns the name of the package configured in its package.json\n * @param packageJsonPath {string} Path to the package.json file\n * @returns A promise that resolves with the name.\n */\nexport async function getPackageName(packageJsonPath: string): Promise<string> {\n  const packageJsonContent = await packageJSONContents(packageJsonPath)\n  return packageJsonContent.name\n}\n\n/**\n * Returns the list of production and dev dependencies of a package.json\n * @param packageJsonPath {string} Path to the package.json file\n * @returns A promise that resolves with the list of dependencies.\n */\nexport async function getDependencies(packageJsonPath: string): Promise<{[key: string]: string}> {\n  const packageJsonContent = await packageJSONContents(packageJsonPath)\n  const dependencies: {[key: string]: string} = packageJsonContent.dependencies ?? {}\n  const devDependencies: {[key: string]: string} = packageJsonContent.devDependencies ?? {}\n\n  return {...dependencies, ...devDependencies}\n}\n\nexport async function checkForNewVersion(dependency: string, currentVersion: string): Promise<string | undefined> {\n  debug(content`Checking if there's a version of ${dependency} newer than ${currentVersion}`)\n  try {\n    const lastVersion = await latestNpmPackageVersion(dependency)\n    if (lastVersion && new Version(currentVersion).compare(lastVersion) < 0) {\n      return lastVersion\n    } else {\n      return undefined\n    }\n    // eslint-disable-next-line no-catch-all/no-catch-all\n  } catch (error) {\n    return undefined\n  }\n}\n\nexport function getOutputUpdateCLIReminder(dependencyManager: DependencyManager, version: string): string {\n  const updateCommand = token.packagejsonScript(dependencyManager, 'shopify', 'upgrade')\n  return content`💡 Version ${version} available! Run ${updateCommand}`.value\n}\n\ninterface PackageJSONContents {\n  name: string\n  version?: string\n  dependencies?: {[key: string]: string}\n  devDependencies?: {[key: string]: string}\n}\n\nexport async function packageJSONContents(packageJsonPath: string): Promise<PackageJSONContents> {\n  if (!(await fileExists(packageJsonPath))) {\n    throw PackageJsonNotFoundError(dirname(packageJsonPath))\n  }\n  return JSON.parse(await readFile(packageJsonPath))\n}\n\nexport type DependencyType = 'dev' | 'prod' | 'peer'\n\ninterface AddNPMDependenciesIfNeededOptions {\n  /** How dependencies should be added */\n  type: DependencyType\n\n  /** The dependency manager to use to add dependencies */\n  dependencyManager: DependencyManager\n\n  /** The directory that contains the package.json where dependencies will be added */\n  directory: string\n\n  /** Standard output coming from the underlying installation process */\n  stdout?: Writable\n\n  /** Standard error coming from the underlying installation process */\n  stderr?: Writable\n\n  /** Abort signal to stop the process */\n  signal?: AbortSignal\n}\n\nexport interface DependencyVersion {\n  name: string\n  version: string | undefined\n}\n\n/**\n * Adds dependencies to a Node project (i.e. a project that has a package.json)\n * @param dependencies {string[]} List of dependencies to be added.\n * @param options {AddNPMDependenciesIfNeededOptions} Options for adding dependencies.\n */\nexport async function addNPMDependenciesIfNeeded(\n  dependencies: DependencyVersion[],\n  options: AddNPMDependenciesIfNeededOptions,\n  force = false,\n) {\n  debug(content`Adding the following dependencies if needed:\n${token.json(dependencies)}\nWith options:\n${token.json(options)}\n  `)\n  const packageJsonPath = pathJoin(options.directory, 'package.json')\n  if (!(await fileExists(packageJsonPath))) {\n    throw PackageJsonNotFoundError(options.directory)\n  }\n  const existingDependencies = Object.keys(await getDependencies(packageJsonPath))\n  let dependenciesToAdd = dependencies\n  if (!force) {\n    dependenciesToAdd = dependencies.filter((dep) => {\n      return !existingDependencies.includes(dep.name)\n    })\n  }\n  if (dependenciesToAdd.length === 0) {\n    return\n  }\n  let args: string[]\n  const depedenciesWithVersion = dependenciesToAdd.map((dep) => {\n    return dep.version ? `${dep.name}@${dep.version}` : dep.name\n  })\n  switch (options.dependencyManager) {\n    case 'npm':\n      args = argumentsToAddDependenciesWithNPM(depedenciesWithVersion, options.type)\n      break\n    case 'yarn':\n      args = argumentsToAddDependenciesWithYarn(depedenciesWithVersion, options.type)\n      break\n    case 'pnpm':\n      args = argumentsToAddDependenciesWithPNPM(depedenciesWithVersion, options.type)\n      break\n  }\n  options.stdout?.write(`Executing...${args.join(' ')}`)\n  await exec(options.dependencyManager, args, {\n    cwd: options.directory,\n    stdout: options.stdout,\n    stderr: options.stderr,\n    signal: options.signal,\n  })\n}\n\nexport async function addNPMDependenciesWithoutVersionIfNeeded(\n  dependencies: string[],\n  options: AddNPMDependenciesIfNeededOptions,\n) {\n  await addNPMDependenciesIfNeeded(\n    dependencies.map((dependency) => {\n      return {name: dependency, version: undefined}\n    }),\n    options,\n  )\n}\n\n// eslint-disable-next-line no-warning-comments\n// TODO: Switch it around so add-if-needed depends on this, rather than calling\n// if-needed with force: true which is counterintuitive.\nexport async function addLatestNPMDependencies(dependencies: string[], options: AddNPMDependenciesIfNeededOptions) {\n  await addNPMDependenciesIfNeeded(\n    dependencies.map((dependency) => {\n      return {name: dependency, version: 'latest'}\n    }),\n    options,\n    true,\n  )\n}\n\n/**\n * Returns the arguments to add dependencies using NPM.\n * @param dependencies {string[]} The list of dependencies to add\n * @param type {DependencyType} The dependency type.\n * @returns {string[]} An array with the arguments.\n */\nfunction argumentsToAddDependenciesWithNPM(dependencies: string[], type: DependencyType): string[] {\n  let command = ['install']\n  command = command.concat(dependencies)\n  switch (type) {\n    case 'dev':\n      command.push('--save-dev')\n      break\n    case 'peer':\n      command.push('--save-peer')\n      break\n    case 'prod':\n      command.push('--save-prod')\n      break\n  }\n  return command\n}\n\n/**\n * Returns the arguments to add dependencies using Yarn.\n * @param dependencies {string[]} The list of dependencies to add\n * @param type {DependencyType} The dependency type.\n * @returns {string[]} An array with the arguments.\n */\nfunction argumentsToAddDependenciesWithYarn(dependencies: string[], type: DependencyType): string[] {\n  let command = ['add']\n  command = command.concat(dependencies)\n  switch (type) {\n    case 'dev':\n      command.push('--dev')\n      break\n    case 'peer':\n      command.push('--peer')\n      break\n    case 'prod':\n      command.push('--prod')\n      break\n  }\n  return command\n}\n\n/**\n * Returns the arguments to add dependencies using PNPM.\n * @param dependencies {string[]} The list of dependencies to add\n * @param type {DependencyType} The dependency type.\n * @returns {string[]} An array with the arguments.\n */\nfunction argumentsToAddDependenciesWithPNPM(dependencies: string[], type: DependencyType): string[] {\n  let command = ['add']\n  command = command.concat(dependencies)\n  switch (type) {\n    case 'dev':\n      command.push('--save-dev')\n      break\n    case 'peer':\n      command.push('--save-peer')\n      break\n    case 'prod':\n      command.push('--save-prod')\n      break\n  }\n  return command\n}\n\nexport type ProjectType = 'node' | 'php' | 'ruby' | undefined\n\nexport async function getProjectType(directory: string): Promise<ProjectType> {\n  const nodeConfigFile = pathJoin(directory, 'package.json')\n  const rubyConfigFile = pathJoin(directory, 'Gemfile')\n  const phpConfigFile = pathJoin(directory, 'composer.json')\n\n  if (await fileExists(nodeConfigFile)) {\n    return 'node'\n  } else if (await fileExists(rubyConfigFile)) {\n    return 'ruby'\n  } else if (await fileExists(phpConfigFile)) {\n    return 'php'\n  }\n  return undefined\n}\n\n/**\n * Given a directory it traverses the directory up looking for a package.json and if found, it reads it\n * decodes the JSON, and returns its content as a Javascript object.\n * @param options {string} The directory from which traverse up.\n * @returns {Promise<{path: string; content: unknown}>} If found, the promise resolves with the path to the\n *  package.json and its content. If not found, it throws a FindUpAndReadPackageJsonNotFoundError error.\n */\nexport async function findUpAndReadPackageJson(fromDirectory: string): Promise<{path: string; content: unknown}> {\n  const packageJsonPath = await findUp('package.json', {cwd: fromDirectory, type: 'file'})\n  if (packageJsonPath) {\n    const packageJson = JSON.parse(await readFile(packageJsonPath))\n    return {path: packageJsonPath, content: packageJson}\n  } else {\n    throw FindUpAndReadPackageJsonNotFoundError(fromDirectory)\n  }\n}\n"]}